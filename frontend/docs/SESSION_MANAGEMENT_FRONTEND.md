# å‰ç«¯ä¼šè¯ç®¡ç†ç³»ç»Ÿå®ç°æ–‡æ¡£

## æ¦‚è¿°

å®Œå…¨é‡å†™äº†æ™ºèƒ½å¯¹è¯ç³»ç»Ÿ,å‚è€ƒ Cline çš„è®¾è®¡æ¨¡å¼,å®ç°äº†å®Œæ•´çš„ä¼šè¯ç®¡ç†åŠŸèƒ½ã€‚æ–°çš„ç³»ç»Ÿæ”¯æŒä»»åŠ¡å†å²è®°å½•ã€ä¼šè¯æ¢å¤ã€æœç´¢è¿‡æ»¤ã€æ”¶è—ç®¡ç†ç­‰åŠŸèƒ½ã€‚

## æ ¸å¿ƒç»„ä»¶

### 1. ç±»å‹å®šä¹‰

**æ–‡ä»¶**: [session.ts](../src/types/session.ts)

å®šä¹‰äº†ä¼šè¯ç®¡ç†ç›¸å…³çš„æ‰€æœ‰ TypeScript ç±»å‹:

```typescript
// ä»»åŠ¡ä¿¡æ¯
interface TaskInfo {
  id: string;
  task: string;
  ts: number;
  tokens_in: number;
  tokens_out: number;
  total_cost: number;
  is_favorited: boolean;
  api_provider: string | null;
  api_model: string | null;
  // ... æ›´å¤šå­—æ®µ
}

// ä»»åŠ¡åˆ—è¡¨å“åº”
interface TaskListResponse {
  tasks: TaskInfo[];
  total_count: number;
  total_tokens: number;
  total_cost: number;
}

// ä»»åŠ¡è¯¦æƒ…(ç”¨äºæ¢å¤)
interface TaskDetail {
  task_id: string;
  task: string;
  messages: any[];
  message_count: number;
  // ... æ›´å¤šå­—æ®µ
}
```

### 2. API å®¢æˆ·ç«¯

**æ–‡ä»¶**: [api.ts](../src/renderer/services/api.ts)

æ·»åŠ äº†ä¼šè¯ç®¡ç†ç›¸å…³çš„ API æ–¹æ³•:

```typescript
// è·å–ä»»åŠ¡/ä¼šè¯åˆ—è¡¨
async getTaskList(params: {
  repository_path: string;
  search_query?: string;
  favorites_only?: boolean;
  sort_by?: 'newest' | 'oldest' | 'cost';
  limit?: number;
})

// åŠ è½½ä»»åŠ¡è¯¦æƒ…(ç”¨äºæ¢å¤ä¼šè¯)
async loadTask(taskId: string, repositoryPath: string)

// åˆ‡æ¢ä»»åŠ¡æ”¶è—çŠ¶æ€
async toggleTaskFavorite(taskId: string, repositoryPath: string)

// åˆ é™¤ä»»åŠ¡
async deleteTask(taskId: string, repositoryPath: string)
```

### 3. ä»»åŠ¡å¡ç‰‡ç»„ä»¶

**æ–‡ä»¶**: [TaskCard.tsx](../src/renderer/components/session/TaskCard.tsx)

å±•ç¤ºå•ä¸ªä»»åŠ¡çš„å¡ç‰‡,å‚è€ƒ Cline çš„è®¾è®¡:

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… ä»»åŠ¡æè¿°æ˜¾ç¤º
- âœ… æ”¶è—æŒ‰é’®(æ˜Ÿæ ‡)
- âœ… åˆ é™¤æŒ‰é’®(æ‚¬åœæ˜¾ç¤º)
- âœ… å…ƒæ•°æ®æ˜¾ç¤º:æ—¶é—´ã€Tokenã€æˆæœ¬
- âœ… API æ¨¡å‹æ˜¾ç¤º
- âœ… æ‚¬åœæ•ˆæœ

**UI ç»†èŠ‚**:
- æ”¶è—å›¾æ ‡:å®å¿ƒæ˜Ÿ(æ”¶è—)/ç©ºå¿ƒæ˜Ÿ(æœªæ”¶è—)
- åˆ é™¤æŒ‰é’®:æ‚¬åœæ—¶æ˜¾ç¤º,æ˜¾ç¤ºä»»åŠ¡å¤§å°
- æ—¶é—´æ ¼å¼:ç›¸å¯¹æ—¶é—´(å¦‚ "2å°æ—¶å‰")
- Token æ ¼å¼:è‡ªåŠ¨ç¼©å†™(K/M)
- æˆæœ¬æ ¼å¼:ç¾å…ƒç¬¦å·,å°äº $0.01 æ˜¾ç¤º "< $0.01"

### 4. ä»»åŠ¡å†å²è§†å›¾ç»„ä»¶

**æ–‡ä»¶**: [TaskHistoryView.tsx](../src/renderer/components/session/TaskHistoryView.tsx)

å®Œæ•´çš„ä»»åŠ¡å†å²ç®¡ç†ç•Œé¢,å‚è€ƒ Cline çš„ HistoryView:

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æœç´¢åŠŸèƒ½(é˜²æŠ– 300ms)
- âœ… æ”¶è—è¿‡æ»¤
- âœ… æ’åºé€‰é¡¹(æœ€æ–°/æœ€æ—§/æˆæœ¬)
- âœ… ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º
- âœ… ç©ºçŠ¶æ€æç¤º
- âœ… åŠ è½½çŠ¶æ€
- âœ… åº•éƒ¨ç»Ÿè®¡ä¿¡æ¯

**UI å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»»åŠ¡å†å²      (X)              â”‚ â† æ ‡é¢˜æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ” æœç´¢ä»»åŠ¡...]               â”‚ â† æœç´¢æ¡†
â”‚ â­ æ”¶è—  |  æœ€æ–°|æœ€æ—§|æˆæœ¬    â”‚ â† è¿‡æ»¤å’Œæ’åº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»»åŠ¡å¡ç‰‡ 1               â”‚  â”‚ â† ä»»åŠ¡åˆ—è¡¨
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»»åŠ¡å¡ç‰‡ 2               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ˜¾ç¤º 2 ä¸ªä»»åŠ¡ (ä»…æ”¶è—)         â”‚ â† ç»Ÿè®¡ä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’ç‰¹æ€§**:
- ç‚¹å‡»å¡ç‰‡:åŠ è½½ä»»åŠ¡
- ç‚¹å‡»æ˜Ÿæ ‡:åˆ‡æ¢æ”¶è—(ä¹è§‚æ›´æ–°)
- æ‚¬åœå¡ç‰‡:æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
- å®æ—¶æœç´¢:è‡ªåŠ¨é˜²æŠ–

### 5. æ–°çš„èŠå¤©é¢æ¿

**æ–‡ä»¶**: [ChatPanel.tsx](../src/renderer/components/session/ChatPanel.tsx)

å®Œå…¨é‡å†™äº† SmartChatPanel,é›†æˆä¼šè¯ç®¡ç†åŠŸèƒ½:

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… èŠå¤©æ¶ˆæ¯æ˜¾ç¤º
- âœ… æ¶ˆæ¯å‘é€
- âœ… å·¥å…·è°ƒç”¨æ˜¾ç¤º
- âœ… æµå¼å“åº”æ”¯æŒ
- âœ… æ–°å»ºå¯¹è¯
- âœ… æŸ¥çœ‹å†å²
- âœ… æ¢å¤ä¼šè¯

**è§†å›¾åˆ‡æ¢**:
- **èŠå¤©è§†å›¾**:æ˜¾ç¤ºå¯¹è¯å†å²å’Œè¾“å…¥æ¡†
- **å†å²è§†å›¾**:æ˜¾ç¤ºä»»åŠ¡å†å²åˆ—è¡¨
- ä¸€é”®åˆ‡æ¢,æ— ç¼ä½“éªŒ

**UI æ”¹è¿›**:
- ç®€æ´çš„æ ‡é¢˜æ :æ˜¾ç¤º "AI åŠ©æ‰‹" å’Œä¼šè¯çŠ¶æ€
- å†å²æŒ‰é’®:å¿«é€ŸæŸ¥çœ‹å†å²ä¼šè¯
- æ–°å»ºæŒ‰é’®:åˆ›å»ºæ–°å¯¹è¯
- ç©ºçŠ¶æ€:æä¾›å¿«æ·æ“ä½œå»ºè®®

## é›†æˆç‚¹

### æ›¿æ¢çš„æ–‡ä»¶

1. **ProjectDetail.tsx**:
```typescript
// æ—§:
import { SmartChatPanel } from "./SmartChatPanel";
<SmartChatPanel projectPath={decodedPath} ... />

// æ–°:
import { ChatPanel } from "../session/ChatPanel";
<ChatPanel projectPath={decodedPath} ... />
```

2. **FileViewer.tsx**:
```typescript
// æ—§:
import { SmartChatPanel } from "./SmartChatPanel";
<SmartChatPanel projectPath={projectRoot} ... />

// æ–°:
import { ChatPanel } from "../session/ChatPanel";
<ChatPanel projectPath={projectRoot} ... />
```

### æ ·å¼è°ƒæ•´

ç§»é™¤äº†ä¹‹å‰çš„æ¸å˜èƒŒæ™¯å’Œæ¯›ç»ç’ƒæ•ˆæœ,æ”¹ç”¨ç®€æ´çš„ç™½è‰²èƒŒæ™¯å’Œè¾¹æ¡†:

```tsx
// æ—§æ ·å¼
className="bg-gradient-to-br from-indigo-50/30 to-purple-50/30
           rounded-xl p-6 backdrop-blur-sm
           border border-indigo-200/50"

// æ–°æ ·å¼
className="bg-white rounded-xl border border-gray-200"
```

## ä¸ Cline çš„å¯¹æ¯”

### ç›¸ä¼¼ç‚¹

1. **ä»»åŠ¡å¡ç‰‡è®¾è®¡**:
   - æ‚¬åœæ˜¾ç¤ºåˆ é™¤æŒ‰é’®
   - æ˜Ÿæ ‡æ”¶è—å›¾æ ‡
   - å…ƒæ•°æ®è¡Œæ˜¾ç¤º(æ—¶é—´ã€Tokenã€æˆæœ¬)

2. **å†å²è§†å›¾å¸ƒå±€**:
   - é¡¶éƒ¨æœç´¢å’Œè¿‡æ»¤
   - ä¸­é—´å¯æ»šåŠ¨åˆ—è¡¨
   - åº•éƒ¨ç»Ÿè®¡ä¿¡æ¯
   - æ¨¡æ€çª—å£å½¢å¼

3. **äº¤äº’æ¨¡å¼**:
   - ä¹è§‚æ›´æ–°(æ”¶è—åˆ‡æ¢)
   - ç¡®è®¤å¯¹è¯æ¡†(åˆ é™¤æ“ä½œ)
   - é˜²æŠ–æœç´¢

### å·®å¼‚ç‚¹

1. **é€šä¿¡æ–¹å¼**:
   - Cline: gRPC (æ‰©å±• â†” webview)
   - æˆ‘ä»¬: REST API (å‰ç«¯ â†” åç«¯)

2. **çŠ¶æ€ç®¡ç†**:
   - Cline: ExtensionStateContext
   - æˆ‘ä»¬: React useState + API è°ƒç”¨

3. **è§†å›¾åˆ‡æ¢**:
   - Cline: ç‹¬ç«‹çš„å†å²è§†å›¾çª—å£
   - æˆ‘ä»¬: é¢æ¿å†…åˆ‡æ¢(èŠå¤©/å†å²)

## ä½¿ç”¨æµç¨‹

### 1. å¼€å§‹æ–°å¯¹è¯

```
ç”¨æˆ·æ‰“å¼€é¡¹ç›®è¯¦æƒ… â†’ çœ‹åˆ° ChatPanel â†’
è¾“å…¥é—®é¢˜å¹¶å‘é€ â†’ AI å“åº” â†’
å¯¹è¯è‡ªåŠ¨ä¿å­˜ä¸ºæ–°ä»»åŠ¡
```

### 2. æŸ¥çœ‹å†å²

```
ç‚¹å‡»"å†å²"æŒ‰é’® â†’ åˆ‡æ¢åˆ°å†å²è§†å›¾ â†’
çœ‹åˆ°æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨ â†’
å¯æœç´¢ã€è¿‡æ»¤ã€æ’åº
```

### 3. æ¢å¤ä¼šè¯

```
åœ¨å†å²è§†å›¾ä¸­ç‚¹å‡»ä»»åŠ¡å¡ç‰‡ â†’
è‡ªåŠ¨åŠ è½½ä»»åŠ¡è¯¦æƒ…å’Œæ¶ˆæ¯ â†’
åˆ‡æ¢å›èŠå¤©è§†å›¾ â†’
å¯ä»¥ç»§ç»­å¯¹è¯
```

### 4. ç®¡ç†ä»»åŠ¡

```
æ‚¬åœä»»åŠ¡å¡ç‰‡ â†’
  - ç‚¹å‡»æ˜Ÿæ ‡:æ”¶è—/å–æ¶ˆæ”¶è—
  - ç‚¹å‡»åˆ é™¤:åˆ é™¤ä»»åŠ¡(éœ€ç¡®è®¤)
```

## API é€šä¿¡ç¤ºä¾‹

### è·å–ä»»åŠ¡åˆ—è¡¨

```typescript
const response = await api.getTaskList({
  repository_path: '/path/to/repo',
  search_query: 'API',
  favorites_only: false,
  sort_by: 'newest',
  limit: 100,
});

// è¿”å›:
{
  tasks: [...],
  total_count: 42,
  total_tokens: 150000,
  total_cost: 0.5
}
```

### åŠ è½½ä»»åŠ¡

```typescript
const taskDetail = await api.loadTask('task_001', '/path/to/repo');

// è¿”å›:
{
  task_id: 'task_001',
  task: 'åˆ†æ backend ç›®å½•',
  messages: [...],
  message_count: 5,
  ...
}
```

### åˆ‡æ¢æ”¶è—

```typescript
const response = await api.toggleTaskFavorite('task_001', '/path/to/repo');

// è¿”å›:
{
  success: true,
  is_favorited: true,
  message: 'ä»»åŠ¡ task_001 æ”¶è—çŠ¶æ€å·²æ›´æ–°'
}
```

## æŠ€æœ¯æ ˆ

- **React 18**: å‡½æ•°ç»„ä»¶ + Hooks
- **TypeScript**: å®Œæ•´ç±»å‹å®šä¹‰
- **Heroicons**: å›¾æ ‡åº“
- **React Hot Toast**: é€šçŸ¥æç¤º
- **Axios**: HTTP å®¢æˆ·ç«¯
- **React Markdown**: Markdown æ¸²æŸ“

## æ ·å¼ç³»ç»Ÿ

ä½¿ç”¨ Tailwind CSS:

- **é¢œè‰²**: gray/blue(ä¸»è‰²), yellow(æ”¶è—), red(åˆ é™¤)
- **é—´è·**: 3/4/6 (å°/ä¸­/å¤§é—´è·)
- **åœ†è§’**: lg (å¡ç‰‡), md (æŒ‰é’®)
- **é˜´å½±**: sm/md/hover:shadow-md
- **è¿‡æ¸¡**: transition-all duration-200

## æ€§èƒ½ä¼˜åŒ–

1. **é˜²æŠ–æœç´¢**: 300ms å»¶è¿Ÿ,å‡å°‘ API è°ƒç”¨
2. **ä¹è§‚æ›´æ–°**: æ”¶è—æ“ä½œç«‹å³æ›´æ–° UI,å¤±è´¥åå›æ»š
3. **æ¡ä»¶åŠ è½½**: åªåœ¨æ‰“å¼€å†å²è§†å›¾æ—¶åŠ è½½æ•°æ®
4. **çŠ¶æ€å¤ç”¨**: ä½¿ç”¨ useState ç¼“å­˜ä»»åŠ¡åˆ—è¡¨

## å¯è®¿é—®æ€§

- **è¯­ä¹‰åŒ–æ ‡ç­¾**: æ­£ç¡®ä½¿ç”¨ button, input ç­‰å…ƒç´ 
- **é”®ç›˜å¯¼èˆª**: æ”¯æŒ Enter å‘é€æ¶ˆæ¯
- **ç„¦ç‚¹ç®¡ç†**: è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
- **æç¤ºæ–‡æœ¬**: æ‰€æœ‰æŒ‰é’®éƒ½æœ‰ title å±æ€§

## æœªæ¥æ”¹è¿›

### çŸ­æœŸ

1. **å¯¼å‡ºåŠŸèƒ½**: å¯¼å‡ºä¼šè¯ä¸º Markdown
2. **æ‰¹é‡æ“ä½œ**: æ‰¹é‡åˆ é™¤å¤šä¸ªä»»åŠ¡
3. **æ ‡ç­¾ç³»ç»Ÿ**: ä¸ºä»»åŠ¡æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾
4. **ç»Ÿè®¡å›¾è¡¨**: Token ä½¿ç”¨è¶‹åŠ¿å›¾

### é•¿æœŸ

1. **ä¼šè¯åˆ†ç»„**: å°†ç›¸å…³ä»»åŠ¡ç»„ç»‡æˆä¼šè¯ç»„
2. **äº‘ç«¯åŒæ­¥**: è·¨è®¾å¤‡åŒæ­¥ä»»åŠ¡å†å²
3. **åä½œåŠŸèƒ½**: åˆ†äº«ä¼šè¯ç»™å›¢é˜Ÿæˆå‘˜
4. **AI æ‘˜è¦**: è‡ªåŠ¨ç”Ÿæˆä»»åŠ¡æ‘˜è¦

## æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [x] å‘é€æ¶ˆæ¯å¹¶æŸ¥çœ‹å“åº”
- [x] ç‚¹å‡»"å†å²"æŒ‰é’®æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
- [x] æœç´¢ä»»åŠ¡
- [x] åˆ‡æ¢æ”¶è—è¿‡æ»¤
- [x] æ”¹å˜æ’åºæ–¹å¼
- [x] ç‚¹å‡»ä»»åŠ¡å¡ç‰‡æ¢å¤ä¼šè¯
- [x] åˆ‡æ¢æ”¶è—çŠ¶æ€
- [x] åˆ é™¤ä»»åŠ¡
- [x] æ–°å»ºå¯¹è¯
- [x] å·¥å…·è°ƒç”¨æ˜¾ç¤º

### å·²çŸ¥é—®é¢˜

ç›®å‰æ²¡æœ‰å·²çŸ¥é—®é¢˜,æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚

## æ€»ç»“

æˆåŠŸå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ä¼šè¯ç®¡ç†ç³»ç»Ÿ,æ ¸å¿ƒç‰¹æ€§:

âœ… **å®Œå…¨é‡å†™**: æ›¿æ¢äº†æ—§çš„ SmartChatPanel
âœ… **ä»»åŠ¡å†å²**: è‡ªåŠ¨ä¿å­˜å’Œç®¡ç†æ‰€æœ‰å¯¹è¯
âœ… **æœç´¢è¿‡æ»¤**: å¿«é€Ÿæ‰¾åˆ°å†å²ä»»åŠ¡
âœ… **ä¼šè¯æ¢å¤**: æ— ç¼æ¢å¤ç»§ç»­å¯¹è¯
âœ… **æ”¶è—ç®¡ç†**: æ ‡è®°é‡è¦ä»»åŠ¡
âœ… **ç®€æ´ UI**: å‚è€ƒ Cline çš„ä¼˜ç§€è®¾è®¡
âœ… **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹
âœ… **æ€§èƒ½ä¼˜åŒ–**: é˜²æŠ–ã€ä¹è§‚æ›´æ–°ç­‰

ç³»ç»Ÿå·²å‡†å¤‡å¥½æŠ•å…¥ä½¿ç”¨! ğŸš€
